{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://backlog-agents/backlog.config.schema.json",
  "title": "Backlog Agents Configuration",
  "description": "Schema for backlog.config.json files used by backlog-agents skills.",
  "type": "object",
  "required": ["version", "project", "backlog", "qualityGates", "codeRules", "ticketValidation"],
  "additionalProperties": false,
  "properties": {
    "version": {
      "type": "string",
      "description": "Configuration schema version.",
      "enum": ["1.0"]
    },
    "project": {
      "type": "object",
      "description": "Project-level metadata.",
      "required": ["name", "stack"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable project name.",
          "minLength": 1
        },
        "stack": {
          "type": "string",
          "description": "Primary technology stack (e.g. typescript, python, generic).",
          "minLength": 1
        },
        "testRunner": {
          "type": "string",
          "description": "Test runner used by the project (e.g. vitest, jest, pytest)."
        },
        "linter": {
          "type": "string",
          "description": "Linter used by the project (e.g. eslint, ruff)."
        },
        "typeChecker": {
          "type": "string",
          "description": "Type checker used by the project (e.g. tsc, mypy)."
        }
      }
    },
    "backlog": {
      "type": "object",
      "description": "Backlog data and template configuration.",
      "required": ["dataDir", "templatesDir", "ticketPrefixes", "requiredSections"],
      "additionalProperties": false,
      "properties": {
        "dataDir": {
          "type": "string",
          "description": "Directory where ticket data files are stored.",
          "minLength": 1
        },
        "templatesDir": {
          "type": "string",
          "description": "Directory where ticket templates are stored.",
          "minLength": 1
        },
        "ticketPrefixes": {
          "type": "array",
          "description": "Allowed ticket-type prefixes.",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "minItems": 1,
          "uniqueItems": true
        },
        "requiredSections": {
          "type": "array",
          "description": "Sections that every ticket must include.",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "minItems": 1,
          "uniqueItems": true
        }
      }
    },
    "qualityGates": {
      "type": "object",
      "description": "Commands executed as quality gates during ticket implementation.",
      "required": ["testCommand"],
      "additionalProperties": false,
      "properties": {
        "lintCommand": {
          "type": "string",
          "description": "Command to run the linter."
        },
        "typeCheckCommand": {
          "type": "string",
          "description": "Command to run the type checker."
        },
        "testCommand": {
          "type": "string",
          "description": "Command to run the test suite.",
          "minLength": 1
        },
        "buildCommand": {
          "type": "string",
          "description": "Command to build the project."
        },
        "healthCheckCommand": {
          "type": "string",
          "description": "Command to verify project health after changes."
        }
      }
    },
    "codeRules": {
      "type": "object",
      "description": "Code-quality rules enforced during implementation.",
      "additionalProperties": false,
      "properties": {
        "source": {
          "type": "string",
          "description": "Path to a Markdown file containing code rules."
        },
        "hardGates": {
          "type": "array",
          "description": "Rules that must pass; failure blocks ticket completion.",
          "items": {
            "type": "string"
          }
        },
        "softGates": {
          "type": "array",
          "description": "Rules that are checked but do not block ticket completion.",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "ticketValidation": {
      "type": "object",
      "description": "Validation rules applied when creating or updating tickets.",
      "required": [
        "requireTestStrategy",
        "requireAffectedFiles",
        "requireDependencyCheck",
        "minAcceptanceCriteria",
        "requireVerificationCommands"
      ],
      "additionalProperties": false,
      "properties": {
        "requireTestStrategy": {
          "type": "boolean",
          "description": "Whether tickets must include a test strategy section."
        },
        "requireAffectedFiles": {
          "type": "boolean",
          "description": "Whether tickets must list affected files."
        },
        "requireDependencyCheck": {
          "type": "boolean",
          "description": "Whether tickets must include a dependency check."
        },
        "minAcceptanceCriteria": {
          "type": "integer",
          "description": "Minimum number of acceptance criteria required per ticket.",
          "minimum": 1
        },
        "requireVerificationCommands": {
          "type": "boolean",
          "description": "Whether tickets must include verification commands."
        }
      }
    },
    "agentRouting": {
      "type": "object",
      "description": "Smart agent routing configuration. Determines which agent handles a ticket based on pattern matching.",
      "properties": {
        "rules": {
          "type": "array",
          "description": "Ordered list of routing rules. First matching rule wins.",
          "items": {
            "type": "object",
            "required": ["pattern", "agent", "label"],
            "properties": {
              "pattern": {
                "type": "string",
                "description": "Glob or regex pattern matched against ticket prefix or tags."
              },
              "agent": {
                "type": "string",
                "description": "Agent identifier to route the ticket to (e.g. 'implementer', 'investigator')."
              },
              "label": {
                "type": "string",
                "description": "Human-readable label describing this routing rule."
              }
            }
          }
        },
        "overrides": {
          "type": "object",
          "description": "Per-agent overrides keyed by agent identifier.",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "investigator": {
                "type": "boolean",
                "description": "Whether to run an investigation phase before implementation."
              },
              "reviewers": {
                "type": "number",
                "description": "Number of review passes for this agent."
              }
            }
          }
        },
        "llmOverride": {
          "type": "boolean",
          "description": "Allow the LLM to override routing rules based on ticket content analysis.",
          "default": true
        }
      }
    },
    "reviewPipeline": {
      "type": "object",
      "description": "Configurable review pipeline. Defines which reviewers run and their thresholds.",
      "properties": {
        "reviewers": {
          "type": "array",
          "description": "Ordered list of reviewers that evaluate implementation output.",
          "items": {
            "type": "object",
            "required": ["name", "agent", "focus"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Unique name for this reviewer (e.g. 'code-quality', 'security')."
              },
              "agent": {
                "type": "string",
                "description": "Agent identifier that performs this review."
              },
              "focus": {
                "type": "string",
                "description": "Description of what this reviewer evaluates."
              },
              "required": {
                "type": "boolean",
                "description": "Whether this reviewer must pass for the ticket to be accepted.",
                "default": true
              }
            }
          }
        },
        "confidenceThreshold": {
          "type": "number",
          "description": "Minimum confidence score (0-100) required to accept a review.",
          "minimum": 0,
          "maximum": 100,
          "default": 80
        },
        "maxReviewRounds": {
          "type": "number",
          "description": "Maximum number of review-fix cycles before escalation.",
          "default": 3
        }
      }
    }
  }
}
