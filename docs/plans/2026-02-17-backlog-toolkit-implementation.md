# Backlog Toolkit Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build a reusable, stack-agnostic backlog management toolkit as 4 Claude Code skills with centralized configuration.

**Architecture:** 4 independent SKILL.md files read from a shared `backlog.config.json` generated per-project. Templates and config schema live in this repo; skills get installed to `~/.claude/skills/` or `.claude/skills/`.

**Tech Stack:** Claude Code Skills (Markdown), Bash (install script), JSON Schema (config validation)

**Design Doc:** `docs/plans/2026-02-17-backlog-toolkit-design.md`

---

### Task 1: Config Schema + Default Preset

**Files:**
- Create: `config/backlog.config.schema.json`
- Create: `config/presets/default.json`

**Step 1: Write the JSON Schema**

Create `config/backlog.config.schema.json` — validates `backlog.config.json` files generated by backlog-init. Must define:
- `version` (string, required)
- `project` object: `name`, `stack`, `testRunner`, `linter`, `typeChecker`
- `backlog` object: `dataDir`, `templatesDir`, `ticketPrefixes[]`, `requiredSections[]`
- `qualityGates` object: `lintCommand`, `typeCheckCommand`, `testCommand`, `buildCommand`
- `codeRules` object: `source` (path to markdown), `hardGates[]`, `softGates[]`
- `ticketValidation` object: `requireTestStrategy`, `requireAffectedFiles`, `requireDependencyCheck`, `minAcceptanceCriteria`, `requireVerificationCommands`

**Step 2: Write default preset**

Create `config/presets/default.json` — a complete `backlog.config.json` with sensible defaults for a generic project (no stack-specific commands).

**Step 3: Commit**

```bash
git add config/
git commit -m "feat: add config schema and default preset"
```

---

### Task 2: Templates

**Files:**
- Create: `templates/task-template.md`
- Create: `templates/bug-template.md`
- Create: `templates/feature-template.md`
- Create: `templates/idea-template.md`

**Step 1: Write templates**

Each template must include the new ticket format from the design doc:
- YAML frontmatter with `depends_on[]` and `shared_files[]`
- Required sections: Context, Description, Affected Files table, Acceptance Criteria, Test Strategy (Unit + Integration + Verification Commands), Dependencies table, Implementation Notes

Adapt from mi-auditor templates (`/Users/fbelchi/github/mi-auditor/backlog/templates/`) but make stack-agnostic. Remove mi-auditor-specific fields (milestone, sprint, story_points, jira-style fields).

**Step 2: Commit**

```bash
git add templates/
git commit -m "feat: add stack-agnostic ticket templates"
```

---

### Task 3: Skill `backlog-init`

**Files:**
- Create: `skills/backlog-init/SKILL.md`

**Step 1: Write the skill**

The skill must:
1. Ask project name and stack via AskUserQuestion
2. Create directory structure: `backlog/data/pending/`, `backlog/data/completed/`, `backlog/templates/`
3. Copy templates from this toolkit repo (read from `~/.claude/skills/backlog-init/` relative path or use known absolute path)
4. Generate `backlog.config.json` at project root with stack-appropriate values
5. Create `backlog/CLAUDE.md` with conventions (ticket format, severity SLAs, workflow)
6. Optionally create `.claude/code-rules.md` starter

**Allowed tools:** Read, Write, Bash, Glob, Grep, AskUserQuestion

**Key design points:**
- The skill should inline the template content (not rely on file copies) so it works standalone
- Config generation uses the preset from this repo as base, customized with user answers
- Stack detection: ask user but also try to detect from package.json/Cargo.toml/pyproject.toml/go.mod

**Step 2: Commit**

```bash
git add skills/backlog-init/
git commit -m "feat: add backlog-init skill"
```

---

### Task 4: Skill `backlog-ticket`

**Files:**
- Create: `skills/backlog-ticket/SKILL.md`

**Step 1: Write the skill**

This is the most complex skill. It must implement 4 phases:

**Phase 1 — Analysis:**
- Read `backlog.config.json` from project root
- Scan all tickets in `backlog/data/pending/*.md` (read frontmatter for depends_on, shared_files, affected files)
- If description is ambiguous, ask user clarifying questions (like brainstorming skill)

**Phase 2 — Generation:**
- Generate complete ticket markdown following the template format
- Auto-assign next ID based on prefix + existing tickets
- Fill all required sections from config's `requiredSections`

**Phase 3 — Validation (6 checks):**

1. **Completeness**: Verify all `requiredSections` from config are present and non-empty. Verify test strategy has both unit and integration. Verify affected files table is populated.

2. **Backlog coherence**: Grep existing tickets for similar titles/descriptions (semantic similarity via keyword overlap). Check no two tickets have conflicting `shared_files`. Verify all `depends_on` references exist as pending tickets.

3. **Inter-ticket gaps**: For each file in Affected Files, check if other pending tickets also touch it — if so, add to `shared_files` and warn. Check if ticket assumes exports/types that don't exist in codebase AND aren't created by a depends_on ticket.

4. **Contract verification**: For each import/type/function referenced in Implementation Notes or Description, use Grep to verify it exists in codebase. If not found, check if a depends_on ticket creates it. If neither, warn.

5. **Impact analysis**: For each file being modified, use Grep to find what imports it. List affected downstream modules. If any are touched by other pending tickets, flag coordination needed.

6. **Consistency check**: Verify file paths follow project conventions (detected from existing structure). Verify naming patterns match codebase.

**Phase 4 — Output:**
- If all checks pass: write ticket to `backlog/data/pending/TYPE-NNN-slug.md`
- If warnings: show warnings, ask user to resolve or accept, optionally generate additional tickets for gaps
- Show summary: ticket ID, dependencies, shared files, impact

**Allowed tools:** Read, Write, Bash, Glob, Grep, AskUserQuestion, Task (for codebase analysis subagents)

**Step 2: Commit**

```bash
git add skills/backlog-ticket/
git commit -m "feat: add backlog-ticket skill with 6-check validation"
```

---

### Task 5: Skill `backlog-refinement`

**Files:**
- Create: `skills/backlog-refinement/SKILL.md`

**Step 1: Write the skill**

Adapt from mi-auditor v2.0 (`/Users/fbelchi/github/mi-auditor/.claude/skills/backlog-refinement/SKILL.md`).

**Key changes from v2.0:**
- Replace hardcoded Memory Bridge MCP calls with optional check: "If MCP memory tools are available, use them for semantic duplicate detection. Otherwise, use keyword-based Grep."
- Replace hardcoded file structure assumptions with reads from `backlog.config.json`
- Add validation of new required sections: Test Strategy, Dependencies, Affected Files
- Remove mi-auditor-specific ticket type prefixes (M1, M2, M3, AUDIT) — read from config's `ticketPrefixes`
- Keep all 5 phases: Inventory → Validation → Workflow → Actions → Output
- Keep refinement report generation

**Allowed tools:** Read, Glob, Grep, Bash, Edit, Write, Task

**Step 2: Commit**

```bash
git add skills/backlog-refinement/
git commit -m "feat: add backlog-refinement skill (adapted from v2.0)"
```

---

### Task 6: Skill `backlog-implementer`

**Files:**
- Create: `skills/backlog-implementer/SKILL.md`

**Step 1: Write the skill**

Adapt from mi-auditor v5.0 (`/Users/fbelchi/github/mi-auditor/.claude/skills/backlog-implementer/SKILL.md`).

**Key changes from v5.0:**
- Replace hardcoded 28 code rules with: "Read code rules from the file specified in `backlog.config.json` → `codeRules.source`. Include the full content of that file in each implementer's prompt."
- Replace hardcoded quality gate commands with reads from config: `qualityGates.lintCommand`, `qualityGates.typeCheckCommand`, `qualityGates.testCommand`
- Replace hardcoded health checks (`curl localhost:3001/health`) with: "If `qualityGates.healthCheckCommand` exists in config, run it. Otherwise skip."
- Keep 2 Iron Laws verbatim (universal)
- Keep Agent Teams composition (leader + implementers + reviewer + investigator)
- Keep wave selection algorithm, 5 quality gates, antipattern scan concept (but scan reads rules from config)
- Keep state schema v4.0, ticket enrichment, move to completed
- Remove mi-auditor-specific priorities (AUDIT-*-SEC-*) — read prefixes from config

**Allowed tools:** Read, Glob, Grep, Bash, Edit, Write, Task, TeamCreate, TeamDelete, SendMessage, TaskCreate, TaskList, TaskUpdate, TaskGet

**Step 2: Commit**

```bash
git add skills/backlog-implementer/
git commit -m "feat: add backlog-implementer skill (adapted from v5.0)"
```

---

### Task 7: Install Script

**Files:**
- Create: `install.sh`

**Step 1: Write install script**

```bash
#!/bin/bash
# Usage: ./install.sh [--local] [--skills skill1,skill2]
# --local: install to .claude/skills/ in current project
# --skills: comma-separated list (default: all)
# No flags: install to ~/.claude/skills/
```

The script must:
1. Detect target directory (`~/.claude/skills/` or `.claude/skills/`)
2. Copy selected skill directories
3. Print summary of installed skills
4. Verify installation by checking files exist

**Step 2: Make executable and commit**

```bash
chmod +x install.sh
git add install.sh
git commit -m "feat: add install script for skill distribution"
```

---

### Task 8: Tests

**Files:**
- Create: `tests/test-config-schema.sh`
- Create: `tests/test-templates.sh`
- Create: `tests/test-install.sh`

**Step 1: Write validation tests**

- `test-config-schema.sh`: Validate that default.json matches the schema. Validate that a minimal config is accepted. Validate that missing required fields are rejected.
- `test-templates.sh`: Verify all templates have required YAML frontmatter fields. Verify all templates have required sections (from design doc).
- `test-install.sh`: Run install.sh to temp directory, verify all skills copied correctly.

**Step 2: Commit**

```bash
git add tests/
git commit -m "test: add validation tests for config, templates, and install"
```

---

### Task 9: README

**Files:**
- Create: `README.md`

**Step 1: Write README**

Sections:
- What is this (backlog toolkit for Claude Code)
- Quick Start (install.sh + backlog-init)
- Skills overview (table with 4 skills)
- Configuration reference
- Template reference
- Contributing (how to add new skills)

**Step 2: Final commit**

```bash
git add README.md
git commit -m "docs: add README with usage guide"
```
