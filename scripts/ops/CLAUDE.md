# Operations Scripts

## Purpose

Scripts for cloud-first operations: cost tracking, model registry management, and batch processing.

## Scripts

### `cost_guard.py`
Monitor token usage and enforce cost budgets.

**Usage**:
```bash
# Check current spend
./scripts/ops/cost_guard.py --ledger .backlog-ops/usage-ledger.jsonl

# Alert if over budget
./scripts/ops/cost_guard.py \
  --ledger .backlog-ops/usage-ledger.jsonl \
  --max-cost 100.00 \
  --alert-threshold 0.8
```

**Features**:
- Parse JSONL usage ledger
- Calculate total spend
- Break down by skill, model, ticket
- Alert when approaching limits
- Exit non-zero if over budget (for CI)

**Dependencies**: Python 3.10+, `argparse`, `json`

### `sync-model-registry.sh`
Refresh model pricing and availability from providers.

**Usage**:
```bash
./scripts/ops/sync-model-registry.sh
```

**Features**:
- Query LiteLLM or provider APIs
- Update `.backlog-ops/model-registry.json`
- Track model additions/deprecations
- Log changes

**Dependencies**: `curl`, `jq`

**Schedule**: Run daily via cron or CI

### `batch_submit.py`
Submit tickets for async batch processing.

**Usage**:
```bash
# Submit specific tickets
./scripts/ops/batch_submit.py --input backlog/data/pending/FEAT-*.md

# Submit with cost limit
./scripts/ops/batch_submit.py \
  --input backlog/data/pending/*.md \
  --max-cost 50.00 \
  --priority high
```

**Features**:
- Read tickets from pending directory
- Validate ticket format
- Estimate costs
- Enqueue to `.backlog-ops/batch-queue/pending/`
- Respect cost and concurrency limits

**Dependencies**: Python 3.10+, `argparse`, `yaml`

### `batch_reconcile.py`
Reconcile batch results with backlog.

**Usage**:
```bash
# Check status of all batch jobs
./scripts/ops/batch_reconcile.py --status all

# Move completed tickets
./scripts/ops/batch_reconcile.py --status completed --move

# Handle failed jobs
./scripts/ops/batch_reconcile.py --status failed --retry
```

**Features**:
- Query batch job status
- Move completed tickets to `backlog/data/completed/`
- Retry failed jobs
- Log results
- Update cost tracking

**Dependencies**: Python 3.10+, `argparse`, `json`

### `prompt_prefix_lint.py`
Validate prompt prefixes for cache efficiency.

**Usage**:
```bash
# Check all skill files
./scripts/ops/prompt_prefix_lint.py skills/**/*.md

# Fix issues automatically
./scripts/ops/prompt_prefix_lint.py skills/**/*.md --fix
```

**Features**:
- Detect common cache-breaking patterns
- Suggest prefix improvements
- Estimate cache hit improvement
- Auto-fix when safe

**Dependencies**: Python 3.10+, `argparse`, `re`

## Integration Points

### With LiteLLM
Scripts can query LiteLLM proxy for:
- Model availability
- Usage stats
- Cost data

Configure proxy URL in `backlog.config.json`:
```json
{
  "llmOps": {
    "gateway": {
      "baseURL": "http://localhost:8000"
    }
  }
}
```

### With CI/CD
Use in GitHub Actions:
```yaml
- name: Check costs
  run: ./scripts/ops/cost_guard.py --ledger .backlog-ops/usage-ledger.jsonl --max-cost ${{ secrets.COST_LIMIT }}
```

### With Cron
Daily maintenance:
```cron
0 2 * * * /path/to/backlog-agents/scripts/ops/sync-model-registry.sh
0 3 * * * /path/to/backlog-agents/scripts/ops/batch_reconcile.py --status completed --move
```

## Error Handling

All scripts:
- Exit with non-zero status on failure
- Log errors to stderr
- Support `--verbose` flag for debugging
- Include usage help: `--help`

## Related Documentation

- `docs/runbooks/cost-incident-response.md`: Handle budget issues
- `docs/runbooks/batch-operations.md`: Batch processing guide
- `docs/runbooks/cache-optimization.md`: Cache efficiency
- `.backlog-ops/CLAUDE.md`: Operations directory structure


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

### Feb 18, 2026

| ID | Time | T | Title | Read |
|----|------|---|-------|------|
| #7147 | 2:42 PM | ðŸŸ£ | Created operations scripts documentation | ~528 |
</claude-mem-context>